{% extends 'base.html.twig' %}
{% block title %}{{ parent() }} | {{ 'title.rule.create'|trans }}{% endblock %}
{% block titlesm %}{{ 'title.rule.create'|trans }}{% endblock %}

{% block body %}

  <div class="container py-4" id="rule-create">

    {# --- SECTION 1 : Rule Details (sans "Rule folder") --- #}
    {% include 'Rule/create/_details.html.twig' %}      
    <div class="col-12">
        <button type="submit" class="btn btn-primary">{{ 'rule.create.continue'|trans({'default':'Continue'}) }}</button>
    </div>

  </div>
  {# Mini JS pour la vérif d’unicité du nom (compat : id #rulename) #}
  <script>
    (function () {
      const input = document.getElementById('rulename');
      const badge = document.getElementById('rulename-feedback');

      if (!input) return;

      let t;
      input.addEventListener('input', function () {
        clearTimeout(t);
        const name = this.value.trim();
        if (name.length < 3) {
          badge.textContent = '';
          badge.className = 'form-text';
          return;
        }
        t = setTimeout(() => {
          fetch("{{ path('regle_inputs_name_unique') }}", {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: new URLSearchParams({ name })
          })
          .then(r => r.json())
          .then(existsFlag => {
            // ancien endpoint renvoie 0 (dispo) / 1 (existe)
            if (existsFlag === 0 || existsFlag === "0") {
              badge.textContent = "✔";
              badge.className = 'form-text text-success';
            } else {
              badge.textContent = "✘";
              badge.className = 'form-text text-danger';
            }
          })
          .catch(() => {
            badge.textContent = '';
            badge.className = 'form-text';
          });
        }, 300);
      });
    })();
  </script>
{% endblock %}
